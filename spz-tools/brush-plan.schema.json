{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://worldlabs-hackathon.local/spz-tools/brush-plan.schema.json",
  "title": "Gaussian Splat Brush Plan",
  "type": "object",
  "additionalProperties": false,
  "required": ["operations"],
  "properties": {
    "operations": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/operation"
      }
    }
  },
  "$defs": {
    "vec3": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": {
        "type": "number"
      }
    },
    "operation": {
      "type": "object",
      "additionalProperties": false,
      "required": ["mode", "shape"],
      "properties": {
        "id": {
          "type": "string"
        },
        "mode": {
          "type": "string",
          "enum": ["paint", "erase", "lighten", "darken", "set_opacity", "add_opacity"]
        },
        "shape": {
          "type": "string",
          "enum": ["capsule", "sphere", "box"]
        },
        "strength": {
          "type": "number",
          "minimum": 0
        },
        "falloff": {
          "type": "string",
          "enum": ["hard", "linear", "smoothstep"]
        },
        "origin": {
          "$ref": "#/$defs/vec3"
        },
        "direction": {
          "$ref": "#/$defs/vec3"
        },
        "depth": {
          "type": "number",
          "exclusiveMinimum": 0
        },
        "radius": {
          "type": "number",
          "exclusiveMinimum": 0
        },
        "center": {
          "$ref": "#/$defs/vec3"
        },
        "halfSize": {
          "$ref": "#/$defs/vec3"
        },
        "colorDc": {
          "$ref": "#/$defs/vec3"
        },
        "amount": {
          "type": "number"
        },
        "eraseOpacity": {
          "type": "number"
        },
        "opacity": {
          "type": "number"
        },
        "opacityDelta": {
          "type": "number"
        },
        "opacityMin": {
          "type": "number"
        },
        "opacityMax": {
          "type": "number"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "shape": { "const": "capsule" } },
            "required": ["shape"]
          },
          "then": {
            "required": ["origin", "direction", "depth", "radius"]
          }
        },
        {
          "if": {
            "properties": { "shape": { "const": "sphere" } },
            "required": ["shape"]
          },
          "then": {
            "required": ["center", "radius"]
          }
        },
        {
          "if": {
            "properties": { "shape": { "const": "box" } },
            "required": ["shape"]
          },
          "then": {
            "required": ["center", "halfSize"]
          }
        },
        {
          "if": {
            "properties": { "mode": { "const": "paint" } },
            "required": ["mode"]
          },
          "then": {
            "required": ["colorDc"]
          }
        },
        {
          "if": {
            "properties": { "mode": { "const": "set_opacity" } },
            "required": ["mode"]
          },
          "then": {
            "required": ["opacity"]
          }
        },
        {
          "if": {
            "properties": { "mode": { "const": "add_opacity" } },
            "required": ["mode"]
          },
          "then": {
            "required": ["opacityDelta"]
          }
        },
        {
          "if": {
            "properties": { "mode": { "enum": ["lighten", "darken"] } },
            "required": ["mode"]
          },
          "then": {
            "required": ["amount"]
          }
        }
      ]
    }
  }
}
